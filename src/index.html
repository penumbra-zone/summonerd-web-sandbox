<!DOCTYPE html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link href="./index.css" rel="stylesheet">
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const svgNS = "http://www.w3.org/2000/svg";
      const pnCyan = "#8be4d9";
      const pnOrange = "#ff902f";
      const pnPurple = "#5F406C";
      const NUMBER_OF_RINGS = 20;
      const RESOLUTION = 9;
      const ARC = (Math.PI * 2) / RESOLUTION;
      const dur = 10;
      const baseRadius = 128;
      const circleArcPath = (r) => `
  M ${-r},0
  a ${r},${r} 0 1,0 ${r * 2},0
  a ${r},${r} 0 1,0 ${-r * 2},0
`;
      const selectRootWaves = () => [
        { amplitude: 6, frequency: 3, phase: 2 * Math.PI * Math.random() },
        { amplitude: 4, frequency: 5, phase: 2 * Math.PI * Math.random() },
        { amplitude: 2, frequency: 7, phase: 2 * Math.PI * Math.random() },
      ];
      const interference = (angleR, waves) => waves.reduce((acc, wave) => acc + wave.amplitude * Math.sin(wave.frequency * angleR + wave.phase), 0);
      const radial = (resolution, waves) => Array.from({ length: resolution }).map((_, i) => interference(i * ARC, waves));
      const catmullRomToBezier = (points) => {
        const d = [];
        for (let i = 1; i < points.length - 2; i++) {
          const p = [points[i - 1], points[i], points[i + 1], points[i + 2]];
          if (i === 1)
            d.push(`M ${p[1][0]},${p[1][1]}`);
          const ctl1x = p[1][0] + (p[2][0] - p[0][0]) / 6;
          const ctl1y = p[1][1] + (p[2][1] - p[0][1]) / 6;
          const ctl2x = p[2][0] - (p[3][0] - p[1][0]) / 6;
          const ctl2y = p[2][1] - (p[3][1] - p[1][1]) / 6;
          d.push(`C ${ctl1x},${ctl1y} ${ctl2x},${ctl2y} ${p[2][0]},${p[2][1]}`);
        }
        return d;
      };
      const radialToBezier = (radials, baseRadius, scale = 0, trans = [0, 0]) => {
        const cartesian = radials.map((radial, i) => {
          const theta = ARC * i;
          const r = baseRadius + radial * scale;
          const x = trans[0] + Math.cos(theta) * r;
          const y = trans[1] + Math.sin(theta) * r;
          return [x, y];
        });
        cartesian.push(cartesian[0], cartesian[1], cartesian[2]);
        const pathSegments = catmullRomToBezier(cartesian);
        return pathSegments.join(" ");
      };
      const generatePathValues = () => {
        const rootWaves = selectRootWaves();
        return Array.from({ length: NUMBER_OF_RINGS })
          .map((_, i) => {
            const iSq = i * i;
            return radialToBezier(radial(RESOLUTION, rootWaves), baseRadius + iSq, iSq * 0.09, [0, iSq + i]);
          })
          .reverse();
      };
      const generatedSvg = document.createElementNS(svgNS, "svg");
      generatedSvg.setAttribute("viewBox", "-400 -200 800 800");
      Object.assign(generatedSvg.style, {
        opacity: "0.9",
        position: "fixed",
        top: "0",
        left: "0",
        width: "100%",
        height: "100%",
      });
      generatedSvg.innerHTML = `
        <defs>
          <radialGradient id="rgrad3">
            <stop offset="50%" stop-color="${pnPurple}" />
            <stop offset="70%" stop-color="${pnOrange}" />
            <stop offset="100%" stop-color="${pnCyan}" />
          </radialGradient>

        </defs>
        <path id="movingPath" stroke-width="3" fill="none" stroke="url(#rgrad3)">
          <animate id="movingPathAnimation"
            attributeName="d" values="${ /* dummy to start anim */"M 0,0;M 0,0"}"
            dur="${dur}s" repeatCount="indefinite"
          />
          <animate
            attributeName="opacity" values="0;0;1;1;1"
            dur="${dur}s" repeatCount="indefinite"
          />
        </path>
        <path id="coreCircle"
          d="${circleArcPath(baseRadius)}"
          opacity="0" fill="black" stroke-width="4"
        >
          <animate 
            attributeName="stroke" values="white;black;black"
            begin="${dur}s;movingPath.end" dur="${dur}s" repeatCount="indefinite"
          />
          <animate
            attributeName="opacity" values="1;0;0;0.5;0.2"
            begin="${dur}s;movingPath.end" dur="${dur}s" repeatCount="indefinite"
          />
        </path>
        <g id="tracerGroup0"></g>
        <g id="tracerGroup1"></g>
      `;
      const movingPathAnimation = generatedSvg.querySelector("#movingPathAnimation");
      const tracerGroups = [
        generatedSvg.querySelector("#tracerGroup0"),
        generatedSvg.querySelector("#tracerGroup1"),
      ];
      let tracerGroupIdx = 0;
      let pathValues = generatePathValues();
      const generateTracerPaths = (idx) => pathValues
        .slice(pathValues.length / 2)
        .map((_, i, paths) => {
          const tracer = document.createElementNS(svgNS, "path");
          tracer.setAttribute("class", "tracerPath");
          tracer.setAttribute("d", _);
          tracer.setAttribute("fill", "none");
          tracer.setAttribute("stroke", "url(#rgrad3)");
          tracer.setAttribute("opacity", "0");
          const stayOn = dur / 2 + ((i + 1.333) / (paths.length - 1)) * (dur / 2);
          tracer.innerHTML = `
            <animate
              attributeName="opacity" values="1;1;0;0;0;0;0;0;0;0"
              begin="${stayOn + dur * idx}" dur="${dur * 2}s" 
              repeatCount="indefinite"
            />
          `;
          return tracer;
        })
        .slice(0, -2);
      const tracerGroupElements = [generateTracerPaths(0), generateTracerPaths(1)];
      const setPaths = () => {
        movingPathAnimation.setAttribute("values", pathValues.filter((_, i) => !(i % 3)).join(";"));
        const onGroup = tracerGroupElements[tracerGroupIdx];
        const offGroup = tracerGroups[tracerGroupIdx];
        offGroup.innerHTML = "";
        generateTracerPaths(tracerGroupIdx).forEach((tracer) => offGroup.appendChild(tracer));
        tracerGroupIdx = Number(!tracerGroupIdx);
        pathValues = generatePathValues();
      };
      setPaths();
      setInterval(setPaths, dur * 1000);
      document.body.appendChild(generatedSvg);
    });
  </script>
</head>

<body class="bg-black text-white">
  <div class="p-4 mb-4">
    <a href="./index.html" class="text-2xl font-bold uppercase hover:text-teal">Penumbra Summoning Ceremony</a>
  </div>

  <div class="space-y-8 mx-auto w-3/4">
    <div class="relative bg-charcoal rounded-lg shadow-sm">
      <div class="relative z-10 p-4 text-lg">
        <div class="mb-4">
          <a href="./1.html" class="font-bold text-3xl bg-text-linear bg-clip-text text-transparent mb-4">Phase 1
            Status</a>
        </div>
        <div>
          <span class="font-bold">Active!</span>
          <span class="font-bold">2</span>
          <span>completed,</span>
          <span class="font-bold">0</span>
          <span>waiting,</span>
          <span class="font-bold">top bid</span>
          <span class="font-mono">0penumbra,</span>
          <span class="font-bold">median bid</span>
          <span class="font-mono">0penumbra</span>
        </div>
      </div>
      <div class="absolute inset-0 z-0 rounded-lg bg-card-radial opacity-20"></div>
    </div>

    <div class="relative bg-charcoal rounded-lg shadow-sm">
      <div class="relative z-10 p-4 text-lg">
        <div class="mb-4">
          <a href="./1.html" class="font-bold text-3xl bg-text-linear bg-clip-text text-transparent mb-4">Phase 2
            Status</a>
        </div>
        <div>
          <span>Waiting for Phase 1...</span>
        </div>
      </div>
      <div class="absolute inset-0 z-0 rounded-lg bg-card-radial opacity-20"></div>
    </div>

    <div class="relative bg-charcoal rounded-lg shadow-sm">
      <div class="relative z-10 p-4 space-y-2">
        <h2 class="font-bold text-3xl bg-text-linear bg-clip-text text-transparent">How to Contribute</h2>
        <h3 class="font-bold text-xl pt-4">Creating a Wallet</h3>
        <p>
          The first step to contributing is to setup a wallet on the command line.
          To do this, follow the <a href="https://guide.penumbra.zone/main/pcli.html" class="underline">Penumbra
            Guide</a>
          in order to setup <span class="font-mono">pcli</span> and create a wallet.
        </p>
        <h3 class="font-bold text-xl pt-4">Receiving Faucet Funds</h3>
        <p>
          After setting up a wallet, you can join our <a href="https://discord.gg/hKvkrqa3zC" class="underline">Public
            Discord</a> in
          order to get testnet funds.
          <br>
          To do this, you need to first get your address from <span class="font-mono">pcli</span>:
        </p>
        <pre
          class="text-sm my-8 p-2 bg-charcoal rounded-lg">cargo run --quiet --release --bin pcli -- view address</pre>
        <p>
          Then, you can go to the <span class="font-bold">#testnet-faucet</span> channel in the Discord, and use that
          address to receive funds.
        </p>
        </p>
        <h3 class="font-bold text-xl pt-4">Contributing</h3>
        <p>
          The coordinator uses the Penumbra testnet to run an anonymous auction for contribution slots.
        </p>
        <p>
          At each slot, the connected participant with the highest bid is selected to contribute.
        </p>
        <p>
          To join the queue, use <span class="font-mono">pcli ceremony contribute</span> to place a bid:
        </p>
        <pre
          class="text-sm my-8 p-4 bg-charcoal rounded-lg overflow-x-auto">cargo run --quiet --release --bin pcli -- ceremony contribute --phase 1 --bid 1penumbra --coordinator-address penumbra12ts5g469dpjdcn2wmdkz25nng6snxkuxumfnmygtrp2fm6776zjw7r35y2j7s07h8368a4kr3c904w8cjgpm6v3ysaj6gh930z7fwlqq9kvjewsy9fgamzxyj874kgu5uvcshg</pre>
        <p>
          The minimum bid for this ceremony is 1penumbra.
        </p>
        <p>
          Once in the queue, you just have to wait until the command completes.
        </p>
        <p>
          To change your bid, you can simply run the command again with a different bid amount. Note that each time you
          bid with the command above, this adds additional funds to all of the previous bids you've already submitted.
        </p>
        <p>
          If you get disconnected for some reason, you can simply bid 0penumbra and recover your position in the queue,
          since all of your previous bids have been recorded.
        </p>
      </div>
      <div class="absolute inset-0 z-0 rounded-lg bg-card-radial opacity-20"></div>
    </div>
</body>

</html>